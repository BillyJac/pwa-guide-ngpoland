<!doctype html>
<html>
    <head>
        <style>
            body {
                margin: 0;
            }

        </style>
        <link href="/indigo-pink.css" rel="stylesheet">
        <link href="/bootstrap.css" rel="stylesheet">

        <script>
            var module = {
                id: null
            };
        </script>
        <script src="/zone.js" defer></script>
        <script src="/Reflect.js" defer></script>
        <script src="/app.js" defer></script>

        <link rel="manifest" href="/manifest.webmanifest">
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16">
        <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#DE3541">
        <meta name="theme-color" content="#DE3541">

        <script defer>
            if (navigator.serviceWorker) {
                navigator.serviceWorker.register('/worker-basic.js').then(() => {
                    console.log('Angular service worker installed')
                }, err => {
                    console.error('Angular service worker error:', err);
                });
            }
        </script>

        <script>
            window.addEventListener('beforeinstallprompt', function(e) {
                console.log('[App] Showing install prompt');

                e.userChoice.then(function(choiceResult) {
                    console.log(choiceResult.outcome);
                });
            });
        </script>

    </head>

    <body>
        <app-root></app-root>
        <button id="btnNotification">Push</button>
        <script>

            if (navigator.serviceWorker) {
                navigator.serviceWorker.register('/push-sw.js').then(() => {
                    console.log('Push service worker installed')
                }, err => {
                    console.error('Push service worker error:', err);
                });
            }

            document.querySelector('#btnNotification').addEventListener('click', (e) => {

                console.log('btnNotification click');
                // Request permission to send notifications
                Notification.requestPermission().then(() => {
                    // Get a reference to the SW
                    return navigator.serviceWorker.ready;
                    console.log('btnNotification requestPermission');
                }).then((sw) => {
                    // Tell it to subscribe with the push server
                    return sw.pushManager.subscribe({userVisibleOnly: true});
                    console.log('btnNotification subscribe');
                }).then((subscription) => {
                    // Send details about the subscription to the server
                    return fetch('http://localhost:8090/push', {
                        method: 'POST',
                        body: JSON.stringify({action: 'subscribe', subscription: subscription}),
                        headers: new Headers({'Content-Type': 'application/json'})
                    });
                });
            });
        </script>
    </body>
</html>
